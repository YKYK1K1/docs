(window.webpackJsonp=window.webpackJsonp||[]).push([[125],{880:function(t,a,s){"use strict";s.r(a);var e=s(67),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"集群-eureka-构建步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集群-eureka-构建步骤"}},[t._v("#")]),t._v(" "),s("strong",[t._v("集群 Eureka 构建步骤")])]),t._v(" "),s("h2",{attrs:{id:"eureka-集群原理说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eureka-集群原理说明"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Eureka 集群原理说明")])]),t._v(" "),s("hr"),t._v(" "),s("p",[s("img",{attrs:{src:"/docs/assets/spring-cloud-2/C-module/yky-2020-08-13-141204.png",alt:"Eureka 集群原理说明"}})]),t._v(" "),s("blockquote",[s("p",[t._v("解决办法：搭建Eureka注册中心集群，实现负载均衡+故障容错")])]),t._v(" "),s("h2",{attrs:{id:"eurekaserver-集群环境构建步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eurekaserver-集群环境构建步骤"}},[t._v("#")]),t._v(" "),s("strong",[t._v("EurekaServer 集群环境构建步骤")])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"参考cloud-eureka-server7001"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考cloud-eureka-server7001"}},[t._v("#")]),t._v(" "),s("strong",[t._v("参考cloud-eureka-server7001")])]),t._v(" "),s("h3",{attrs:{id:"新建cloud-eureka-server7002"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建cloud-eureka-server7002"}},[t._v("#")]),t._v(" "),s("strong",[t._v("新建cloud-eureka-server7002")])]),t._v(" "),s("h3",{attrs:{id:"改pom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#改pom"}},[t._v("#")]),t._v(" "),s("strong",[t._v("改POM")])]),t._v(" "),s("h3",{attrs:{id:"修改映射配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改映射配置"}},[t._v("#")]),t._v(" "),s("strong",[t._v("修改映射配置")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("找到 "),s("code",[t._v("C:\\Windows\\System32\\drivers\\etc")]),t._v(" 路径下的"),s("code",[t._v("hosts")]),t._v("文件")]),t._v(" "),s("img",{attrs:{src:"/docs/assets/spring-cloud-2/C-module/yky-20200813152724.png",alt:"hosts文件"}})]),t._v(" "),s("li",[s("strong",[t._v("修改映射配置添加进hosts文件")]),t._v(" "),s("ul",[s("li",[t._v("127.0.0.1  eureka7001.com")]),t._v(" "),s("li",[t._v("127.0.0.1  eureka7002.com")])])])]),t._v(" "),s("h3",{attrs:{id:"写yml（以前单机）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#写yml（以前单机）"}},[t._v("#")]),t._v(" "),s("strong",[t._v("写YML（以前单机）")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7001")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" localhost "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#eureka 服务端的实例名称")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# false 表示不能象注册中心注册自己")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register-with-eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# false 表示自己端就是注册中心,我的职责就是维护服务实例，并不需要去检索服务")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetch-registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置与 Eureka Server 交互的地址查询服务和注册服务都需要依赖这个地址。")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("eureka.instance.hostname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("server.port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/eureka/\n")])])]),s("ul",[s("li",[s("strong",[t._v("7001")])])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7001")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eureka7001.com "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#eureka 服务端的实例名称")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# false 表示不能象注册中心注册自己")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register-with-eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# false 表示自己端就是注册中心,我的职责就是维护服务实例，并不需要去检索服务")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetch-registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置与 Eureka Server 交互的地址查询服务和注册服务都需要依赖这个地址。")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//eureka7002.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7002/eureka/\n")])])]),s("ul",[s("li",[s("strong",[t._v("7002")])])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7002")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" eureka7002.com "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#eureka 服务端的实例名称")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# false 表示不能象注册中心注册自己")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register-with-eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# false 表示自己端就是注册中心,我的职责就是维护服务实例，并不需要去检索服务")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetch-registry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置与 Eureka Server 交互的地址查询服务和注册服务都需要依赖这个地址。")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//eureka7001.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7001/eureka/\n")])])]),s("blockquote",[s("p",[s("strong",[t._v("主启动(复制cloud-eureka-server7001的主启动类到7002即可)")])])]),t._v(" "),s("h2",{attrs:{id:"将支付服务8001微服务发布到上面2台eureka集群配置中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将支付服务8001微服务发布到上面2台eureka集群配置中"}},[t._v("#")]),t._v(" "),s("strong",[t._v("将支付服务8001微服务发布到上面2台Eureka集群配置中")])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"yml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yml"}},[t._v("#")]),t._v(" "),s("strong",[t._v("YML")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//eureka7001.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7001/eureka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//eureka7002.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7002/eureka  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#集群版")]),t._v("\n")])])]),s("h2",{attrs:{id:"将订单服务80微服务发布到上面2台eureka集群配置中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将订单服务80微服务发布到上面2台eureka集群配置中"}},[t._v("#")]),t._v(" "),s("strong",[t._v("将订单服务80微服务发布到上面2台Eureka集群配置中")])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"yml-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#yml-2"}},[t._v("#")]),t._v(" "),s("strong",[t._v("YML")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//eureka7001.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7001/eureka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//eureka7002.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("7002/eureka  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#集群版")]),t._v("\n")])])]),s("h2",{attrs:{id:"测试01"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试01"}},[t._v("#")]),t._v(" "),s("strong",[t._v("测试01")])]),t._v(" "),s("hr"),t._v(" "),s("ol",[s("li",[s("strong",[t._v("先要启动EurekaServer，7001/7002服务")])]),t._v(" "),s("li",[s("strong",[t._v("再要启动服务提供者provider，8001服务")])]),t._v(" "),s("li",[s("strong",[t._v("再要启动消费者，80")])]),t._v(" "),s("li",[s("strong",[t._v("http://localhost/consumer/payment/get/31")])])]),t._v(" "),s("h2",{attrs:{id:"支付服务提供者8001集群环境构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#支付服务提供者8001集群环境构建"}},[t._v("#")]),t._v(" "),s("strong",[t._v("支付服务提供者8001集群环境构建")])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"参考-cloud-provider-payment8001"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考-cloud-provider-payment8001"}},[t._v("#")]),t._v(" "),s("strong",[t._v("参考 "),s("code",[t._v("cloud-provider-payment8001")])])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("新建 "),s("code",[t._v("cloud-provider-payment8002")])])]),t._v(" "),s("li",[s("strong",[t._v("改POM(和8001一样)")])]),t._v(" "),s("li",[s("strong",[t._v("写YML(和8001一样，换个端口)")])]),t._v(" "),s("li",[s("strong",[t._v("主启动(修改为8002)")])]),t._v(" "),s("li",[s("strong",[t._v("业务类(直接从8001粘)")])]),t._v(" "),s("li",[s("strong",[t._v("修改8001/8002的Controller")])])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("8001 和 8002")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"/docs/assets/spring-cloud-2/C-module/yky-2020-08-14-103858.png",alt:"8001 和 8002 controller 新家 serverPort"}})]),t._v(" "),s("h2",{attrs:{id:"负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[t._v("#")]),t._v(" "),s("strong",[t._v("负载均衡")])]),t._v(" "),s("hr"),t._v(" "),s("ol",[s("li",[s("strong",[t._v("bug")])])]),t._v(" "),s("blockquote",[s("p",[t._v("订单服务访问地址不能写死\n改为这个：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" PAYMENT_URL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://CLOUD-PAYMENT-SERVICE"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("strong",[t._v("使用"),s("code",[t._v("@LoadBalanced")]),t._v("注解赋予 RestTemplate 负载均衡的能力")])]),t._v(" "),s("li",[s("strong",[t._v("ApplicationContextBean")])])]),t._v(" "),s("h2",{attrs:{id:"测试02"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试02"}},[t._v("#")]),t._v(" "),s("strong",[t._v("测试02")])]),t._v(" "),s("hr"),t._v(" "),s("ol",[s("li",[s("strong",[t._v("先要启动EurekaServer，7001/7002服务")])]),t._v(" "),s("li",[s("strong",[t._v("再要启动服务提供者provider，8001/8002服务")])]),t._v(" "),s("li",[s("strong",[t._v("http://localhost/consumer/payment/get/31")])]),t._v(" "),s("li",[s("strong",[t._v("结果")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("负载均衡效果达到")])]),t._v(" "),s("li",[s("strong",[t._v("8001/8002端口交替出现")])])])]),t._v(" "),s("li",[s("strong",[t._v("Ribbon和Eureka整合后Consumer可以直接调用服务而不用再关心地址和端口号，且该服务还有负载功能了")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);