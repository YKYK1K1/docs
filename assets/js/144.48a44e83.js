(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{900:function(t,a,s){"use strict";s.r(a);var n=s(67),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"filter-的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#filter-的使用"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Filter 的使用")])]),t._v(" "),s("h2",{attrs:{id:"是什么？"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#是什么？"}},[t._v("#")]),t._v(" "),s("strong",[t._v("是什么？")])]),t._v(" "),s("hr"),t._v(" "),s("p",[t._v("路由过滤器可用于修改进入的 HTTP 请求和返回的 HTTP 响应,路由过滤器只能指定路由进行使用")]),t._v(" "),s("p",[t._v("Spring Cloud Gateway 内置了多种路由过滤器,他们都由 GatewayFilter 的工厂类来产生")]),t._v(" "),s("h2",{attrs:{id:"spring-cloud-gateway的-filter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud-gateway的-filter"}},[t._v("#")]),t._v(" **Spring Cloud Gateway的 Filter **")]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"生命周期，only"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生命周期，only"}},[t._v("#")]),t._v(" "),s("strong",[t._v("生命周期，Only")])]),t._v(" "),s("ul",[s("li",[t._v("pre ：在业务逻辑之前")]),t._v(" "),s("li",[t._v("post ：在业务逻辑之后")])]),t._v(" "),s("h3",{attrs:{id:"种类，only-two"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#种类，only-two"}},[t._v("#")]),t._v(" "),s("strong",[t._v("种类，Only Two")])]),t._v(" "),s("ul",[s("li",[t._v("GatewayFilter ：31种 "),s("font",{attrs:{color:"#FF0000"}},[t._v("单一")])],1),t._v(" "),s("li",[t._v("GlobalFilter ：10种 "),s("font",{attrs:{color:"#FF0000"}},[t._v("全局")])],1)]),t._v(" "),s("h2",{attrs:{id:"常用的-gatewayfilter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用的-gatewayfilter"}},[t._v("#")]),t._v(" "),s("strong",[t._v("常用的 GatewayFilter")])]),t._v(" "),s("hr"),t._v(" "),s("p",[s("code",[t._v("AddRequestParameter")])]),t._v(" "),s("ul",[s("li",[t._v("YML")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[t._v("          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" AddRequestParameter=X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v("                   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 过滤器工厂会在匹配的请求头加上一对请求头，名称为 X-Request-Id 值为 1024")]),t._v("\n")])])]),s("h2",{attrs:{id:"自定义过滤器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义过滤器"}},[t._v("#")]),t._v(" "),s("strong",[t._v("自定义过滤器")])]),t._v(" "),s("hr"),t._v(" "),s("h3",{attrs:{id:"自定义全局-globalfilter"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自定义全局-globalfilter"}},[t._v("#")]),t._v(" "),s("strong",[t._v("自定义全局 GlobalFilter")])]),t._v(" "),s("ul",[s("li",[t._v("两个主要接口介绍\n"),s("ul",[s("li",[t._v("impiemerts "),s("code",[t._v("GlobalFilter")]),t._v(" ，"),s("code",[t._v("Ordered")])])])])]),t._v(" "),s("h3",{attrs:{id:"能干嘛"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#能干嘛"}},[t._v("#")]),t._v(" "),s("strong",[t._v("能干嘛")])]),t._v(" "),s("ul",[s("li",[t._v("全局日志记录")]),t._v(" "),s("li",[t._v("统一网关鉴权")])]),t._v(" "),s("h3",{attrs:{id:"案例代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#案例代码"}},[t._v("#")]),t._v(" "),s("strong",[t._v("案例代码")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @version 1.0\n * @ClassName MyLogGateWayFilter\n * @Description TODO 全局日志\n * @Author YKY\n * @Date 2020/12/24 15:26\n **/")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Slf4j")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MyLogGateWayFilter")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GlobalFilter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Ordered")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ServerWebExchange")]),t._v(" exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("GatewayFilterChain")]),t._v(" chain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"******************come in MyLogGateWayFilter : "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" uname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRequest")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getQueryParams")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFirst")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uname"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*************用户名为 null,非法用户，/(ㄒoㄒ)/~~"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//给一个回应")]),t._v("\n            exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResponse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setStatusCode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HttpStatus")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("NOT_ACCEPTABLE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getResponse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setComplete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" chain"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exchange"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOrder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//加载过滤器的顺序，数字越小优先级越高")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" "),s("strong",[t._v("测试")])]),t._v(" "),s("h4",{attrs:{id:"启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[t._v("#")]),t._v(" "),s("strong",[t._v("启动")])]),t._v(" "),s("br"),t._v(" "),s("p",[s("img",{attrs:{src:"/docs/assets/spring-cloud-2/J-module/yky-20210218142413.png",alt:"启动四个服务"}})]),t._v(" "),s("h4",{attrs:{id:"正确"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#正确"}},[t._v("#")]),t._v(" "),s("strong",[t._v("正确")])]),t._v(" "),s("br"),t._v(" "),s("p",[s("code",[t._v("http://localhost:9527/payment/lb?uname=z3")])]),t._v(" "),s("h4",{attrs:{id:"错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误"}},[t._v("#")]),t._v(" "),s("strong",[t._v("错误")])]),t._v(" "),s("br"),t._v(" "),s("p",[s("code",[t._v("http://localhost:9527/payment/lb?uname=z3")])])])}),[],!1,null,null,null);a.default=e.exports}}]);